---
title: "Next.jsã¨microCMSã‚’ç”¨ã„ãŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒšãƒ¼ã‚¸ä½œæˆ"
emoji: "ğŸ“„"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nextjs","microcms"]
published: true
publication_name: "tam_tam"
---


JSãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§Webåˆ¶ä½œã‚’ã™ã‚‹éš›ã«å•é¡Œã¨ãªã‚‹ã®ãŒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒã§ã™ã€‚ ä»–ã®CMSãªã©ã¨ç•°ãªã‚Šä¸€ã‹ã‚‰è‡ªå‰ã§å®Ÿè£…ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚  
ã“ã®è¤‡é›‘ã•è§£æ¶ˆã‚’ç›®çš„ã«ã€æœ¬è¨˜äº‹ã§ã¯Next.jsã¨microCMSã‚’çµ„ã¿åˆã‚ã›ãŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒã®å®Ÿè£…ä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## å¯¾è±¡
- Next.jsã§ç°¡å˜ãªé–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤çµŒé¨“ãŒã‚ã‚‹æ–¹
- microCMSã«å°‘ã—ã§ã‚‚è§¦ã£ãŸã“ã¨ãŒã‚ã‚‹æ–¹

## å…¨ä½“åƒã¨æµã‚Œ
å‰æã¨ã—ã¦ã€ã€ŒJSãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ç”¨ã„ãŸWebã‚µã‚¤ãƒˆåˆ¶ä½œã«ãŠã‘ã‚‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒšãƒ¼ã‚¸ã€ã¯CSRãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹æ„Ÿè¦šã¨ä¼¼ã¦ã„ã‚‹ã¨æ‰ãˆã¾ã—ã‚‡ã†ã€‚
1. è©²å½“ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
2. fetchãŒé£›ã¶
3. æƒ…å ±ãŒåŸ‹ã‚è¾¼ã¾ã‚Œã‚‹
4. è¡¨ç¤ºã•ã‚Œã‚‹

ã¨ã„ã£ãŸæµã‚Œã§ã™ã€‚ï¼ˆãã‚‚ãã‚‚CSRãªã©ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ‰‹æ³•ãŒæ›–æ˜§ãªæ–¹ã¯[ã‚³ãƒãƒ©](https://www.patterns.dev/posts/rendering-introduction/)ã‚„[ã‚³ãƒãƒ©](https://zenn.dev/akino/articles/78479998efef55)ã‚’å‚ç…§ãã ã•ã„ï¼‰  

SSGã§ã‚ã‚Œã°åˆ¥é€”CSRã®ãƒšãƒ¼ã‚¸ã‚’ç”¨æ„ã—ã¦ã€SSRã§ã‚ã‚Œã°ãã®ã¾ã¾SSRã‹CSRã®ãƒšãƒ¼ã‚¸ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã¨ãªã‚Šã¾ã™ã€‚
ã¾ãšã¯å›³ã§å…¨ä½“æ„Ÿã‚’æŠ¼ã•ãˆã¦ãŠãã¾ã™ã€‚ç´°ã‹ã„éƒ¨åˆ†ã¯ã“ã‚Œã‹ã‚‰æ´ã‚“ã§ã„ãã¾ã™ã®ã§ã€ã–ã£ã¨ç›®ã‚’é€šã—ã¦ãã ã•ã„ã€‚ï¼ˆã¡ã‚‡ã£ã¨é›‘ãªã®ã¯ã”æ„›å¬Œã§ã™)

```mermaid
sequenceDiagram
    autonumber
    actor editor as ç·¨é›†è€…
    participant browser as ãƒ–ãƒ©ã‚¦ã‚¶(å‡¦ç†éƒ¨)
    participant microCMS
    participant Next.js
    editor->>microCMS: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªãƒ³ã‚¯è¦æ±‚ï¼ˆã‚¯ãƒªãƒƒã‚¯)
    microCMS->>browser: contentId,draftKeyã‚’å«ã‚€URLè¿”å´
    browser->>Next.js: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒšãƒ¼ã‚¸è¦æ±‚ã€‚contentId,draftKeyé€ä¿¡
    Next.js->>microCMS: contentId,draftKey,API-keyã‚’å…ƒã«ãƒªã‚½ãƒ¼ã‚¹å–å¾—
    microCMS->>Next.js: ãƒªã‚½ãƒ¼ã‚¹è¿”å´
    Note right of Next.js: getServerSidePropsã‚‚ã—ãã¯CSRã§fetch
    Next.js->>Next.js:ã€€è¿”å´ãƒªã‚½ãƒ¼ã‚¹åŸ‹ã‚è¾¼ã¿
    Next.js->>browser: Webãƒšãƒ¼ã‚¸è¿”å´
    browser->>editor: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
```

é‡è¦ãªæ¦‚å¿µã¯ã“ã“ã«å‡ºã¦ãã‚‹`contentId`,`draftKey`ã‚’å«ã‚€`URL`ã§ã™ã€‚ 

## å®Ÿè£…
ã•ã£ããå®Ÿè£…æ–¹æ³•ã‚’è€ƒãˆã¦ã„ãã¾ã™ã€‚ã€€ã€€
ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã¯CSRãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿‘ã„ã¨ãŠä¼ãˆã—ã¾ã—ãŸã€‚ã—ãŸãŒã£ã¦

1.  URLã®å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹
2.  ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚§ãƒƒãƒã™ã‚‹æ©Ÿæ§‹ãŒã‚ã‚‹
3.  ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚‹

ã®3ã¤ãŒé”æˆã§ãã‚Œã°å•é¡Œãªã•ãã†ã§ã™ã€‚ã¾ãšã¯ã™ãã«é››å½¢ã®ä½œã‚Œãã†ãª1ç•ªã¨3ç•ªã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```tsx
// src/pages/preview/index.tsx
import type { NextPage } from 'next'
import { useState } from 'react'

const NewsPage: NextPage = () => {
  const [data, setData] = useState()
  useEffect(() => {
    setData({
    title: 'ã‚µãƒ³ãƒ—ãƒ«ã‚¿ã‚¤ãƒˆãƒ«',
    publishedAt: 'ã‚µãƒ³ãƒ—ãƒ«æ—¥æ™‚',
  });
  }, []);

  return (
    <div>
      <h1>{data.title}</h1>
      <p>{data.publishedAt}</p>
    </div>
  );
}

export default NewsPage
```
ã“ã‚Œã§ã²ã¨ã¾ãš`https://ãƒ‰ãƒ¡ã‚¤ãƒ³å/preview/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚Œã°`ã‚µãƒ³ãƒ—ãƒ«ã‚¿ã‚¤ãƒˆãƒ« ã‚µãƒ³ãƒ—ãƒ«æ—¥æ™‚`ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚  
ã—ã‹ã—ã€é‹ç”¨æ™‚ã«åˆ©ç”¨ã™ã‚‹ç·¨é›†è€…ã¯ã“ã®URLã«ã©ã†ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚Œã°è‰¯ã„ã§ã—ã‚‡ã†ã‹ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”¨æ„ã™ã‚‹ãªã©ã®è§£æ±ºç­–ã¯ã‚ã‚Šãã†ã§ã™ãŒè² æ‹…ãŒã‹ã‹ã‚Šãã†ã§ã™ã€‚

ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«microCMSã«ã¯ã€Œç”»é¢ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¨­å®šã€æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ãªè¨­å®šã‚’ã™ã‚‹ã¨ã€
![](/images/microcms_preview.png)
è¨˜äº‹ç”»é¢ã®ã“ã¡ã‚‰ã®ãƒœã‚¿ãƒ³ã‹ã‚‰è¨­å®šã—ãŸURLã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
![](/images/microcms_newsitem.png)

ã“ã‚Œã§ç·¨é›†è€…ãŒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ã“ã®ã¾ã¾ã§ã¯æƒ…å ±ãŒå›ºå®šã•ã‚Œã¦ãŠã‚Šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å½¹å‰²ã‚’æœãŸã›ã¾ã›ã‚“ã®ã§ã€æ¬¡ã«ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã®æ©Ÿæ§‹ã‚’çµ„ã¿è¾¼ã¿ã¾ã™ã€‚
ä»¥å¾Œãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ã¨ã—ã¦è©±ã‚’é€²ã‚ã€[microCMS-js-SDK](https://github.com/microcmsio/microcms-js-sdk)ã‚’ç”¨ã„ã¾ã™ã€‚

```tsx
// libs/client.js
import { createClient } from "microcms-js-sdk";

export const client = createClient({
  serviceDomain: "ã‚µãƒ¼ãƒ“ã‚¹å",
  apiKey: process.env.NEXT_PUBLIC_MICROCMS_API_KEY,
});
```

:::message alert
ç¾æ™‚ç‚¹ã§ã®ã‚³ãƒ¼ãƒ‰ã¯API-keyã®æ¼æ´©ãªã©ã€è¦ä»¶ã«ã‚ˆã£ã¦ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„ãªå•é¡Œã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚è©³ã—ãã¯å¾Œè¿°ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é …ã‚’ã”å‚è€ƒãã ã•ã„ã€‚
:::


```tsx
// pages/preview/index.tsx
import type { NextPage } from 'next'
import { useState } from 'react'

const NewsPage: NextPage = () => {
  const [data, setData] = useState()
  useEffect(() => {
    const getNewsData = async () => {
      const res = await client.get({
        endpoint: "news",
        contentId: "ç‰¹å®šã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ID",
      });
      setData(res);
    };
    getNewsData();
  }, []);

  return (
    <div>
      <h1>{data.title}</h1>
      <p>{data.publishedAt}</p>
    </div>
  );
}

export default NewsPage
```

ã“ã‚Œã§`ç‰¹å®šã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ID`ã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ã«ãªã‚Šã¾ã—ãŸã€‚  
ã•ã‚‰ã«æ‹¡å¼µã—ã€`ç‰¹å®šã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ID`ã¯URLã‹ã‚‰å–å¾—ã§ãã‚‹ã‚ˆã†ã«æ”¹å¤‰ã—ã¾ã—ã‚‡ã†ã€‚

```tsx
// https://domain.com/preview/?slug=ç‰¹å®šã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ID
// src/pages/preview/index.tsx
import type { NextPage } from 'next'
import { useState } from 'react'


const NewsPage: NextPage = () => {
  const [data, setData] = useState()
  const router = useRouter();
  useEffect(() => {
    const getNewsData = async () => {
      if(!router.isReady) return //useRouterã®åˆæœŸåŒ–ãŒå®Œäº†ã—ãŸã‚‰å®Ÿè¡Œ
      const res = await client.get({
        endpoint: "news",
        contentId: router.query.slug, //URLã‹ã‚‰å–å¾—
      });
      setData(res);
    };
    getNewsData();
  }, [router]);ã€€//ä¾å­˜é…åˆ—ã«routerã‚’è¿½åŠ 

  return (
    <div>
      <h1>{data.title}</h1>
      <p>{data.publishedAt}</p>
    </div>
  );
}

export default NewsPage
```

Next.jså´ã®URLæ§‹é€ ã«å¤‰åŒ–ãŒã‚ã‚Šã¾ã—ãŸã®ã§microCMSã®è¨­å®šã‚‚å¤‰æ›´ã—ã¾ã™ã€‚
![](/images/microcms_contentid.png)
`?slug={CONTENT_ID}`ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚  
microCMSã®ç”»é¢ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã¯**è©²å½“è¨˜äº‹ã®è¨˜äº‹IDã‚’å‹•çš„ã«åŸ‹ã‚è¾¼ã‚€æ©Ÿèƒ½**ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒšãƒ¼ã‚¸ã«é£›ã³ã¤ã¤è©²å½“è¨˜äº‹ã®IDã‚’Next.jså´ã«æ¸¡ã™ã€ãã®ãƒšãƒ¼ã‚¸æƒ…å ±ã‚’åŸ‹ã‚è¾¼ã‚€ã¨ã„ã£ãŸã“ã¨ãŒå®Ÿç¾ã§ãã‚‹ã‚ã‘ã§ã™ã€‚

æœ€å¾Œã«ã€ç¾æ™‚ç‚¹ã§ã¯å…¬é–‹æ¸ˆã¿ã®è¨˜äº‹ã—ã‹å–å¾—ã§ããªã„ãŸã‚ä¸‹æ›¸ãçŠ¶æ…‹ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†`darftKey`ã‚‚æ¸¡ã—ã¦ã‚ã’ã¾ã—ã‚‡ã†ã€‚
```tsx
// https://domain.com/preview/?slug=ç‰¹å®šã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ID&draftKey=ç‰¹å®šã®ãƒ‹ãƒ¥ãƒ¼ã‚¹IDã®ä¸‹æ›¸ãã‚­ãƒ¼
// src/pages/preview/index.tsx
import type { NextPage } from 'next'
import { useRouter } from "next/router";
import { useState } from 'react'


const NewsPage: NextPage = () => {
  const [data, setData] = useState()
  const router = useRouter();
  useEffect(() => {
    const getNewsData = async () => {
      if(!router.isReady) return
      const res = await client.get({
        endpoint: "news",
        contentId: router.query.slug,
        queries: { draftKey: router.query.draftKey },
      });
      setData(res);
    };
    getNewsData();
  }, [router]);

  return (
    <div>
      <h1>{data.title}</h1>
      <p>{data.publishedAt}</p>
    </div>
  );
}

export default NewsPage
```
![](/images/microcms_draftkey.png)

ä»¥ä¸Šã§ã€CSRã§ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ãŒå®Ÿè£…ã§ãã¾ã—ãŸã€‚
ã“ã®æµã‚Œã‚’ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«ã™ã‚‹ã¨å…ˆã»ã©ã®å›³ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```mermaid
sequenceDiagram
    autonumber
    actor editor as ç·¨é›†è€…
    participant browser as ãƒ–ãƒ©ã‚¦ã‚¶(å‡¦ç†éƒ¨)
    participant microCMS
    participant Next.js
    editor->>microCMS: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªãƒ³ã‚¯è¦æ±‚ï¼ˆã‚¯ãƒªãƒƒã‚¯)
    microCMS->>browser: contentId,draftKeyã‚’å«ã‚€URLè¿”å´
    browser->>Next.js: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒšãƒ¼ã‚¸è¦æ±‚ã€‚contentId,draftKeyé€ä¿¡
    Next.js->>microCMS: contentId,draftKey,API-keyã‚’å…ƒã«ãƒªã‚½ãƒ¼ã‚¹å–å¾—
    microCMS->>Next.js: ãƒªã‚½ãƒ¼ã‚¹è¿”å´
    Note right of Next.js: getServerSidePropsã‚‚ã—ãã¯CSRã§fetch
    Next.js->>Next.js:ã€€è¿”å´ãƒªã‚½ãƒ¼ã‚¹åŸ‹ã‚è¾¼ã¿
    Next.js->>browser: Webãƒšãƒ¼ã‚¸è¿”å´
    browser->>editor: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
```


## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
å…ˆã»ã©ã®å®Ÿè£…ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå®Ÿè£…ã§ãã¾ã—ãŸã€‚åŸºæœ¬çš„ã«ã¯ä¸Šè¨˜ã§å•é¡Œãªã„ã®ã§ã™ãŒã€å¿µã®ç‚ºã„ãã¤ã‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã™ã‚‹æ³¨æ„äº‹é …ã‚’ãŠä¼ãˆã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
é‡è¦ãªã“ã¨ã¯**API-keyã®éœ²å‡º**ã¨**æ¨©é™è¨­å®š**ã§ã™ã€‚

èª¬æ˜ã—ãŸå®Ÿè£…æ–¹æ³•ã¯CSRã§ã‚ã‚Šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ•ã‚§ãƒƒãƒã—ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã«API-keyãŒåŸ‹ã‚è¾¼ã¾ã‚Œã¦ãŠã‚Šãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰å®¹æ˜“ã«å–å¾—ã§ãã‚‹ãªçŠ¶æ³ã§ã™ã€‚
æ‚ªæ„ã‚ã‚‹ç¬¬ä¸‰è€…ã«å…¨æ¨©é™ã‚’æŒã¤API-keyãŒç›—ã¾ã‚ŒãŸå ´åˆã€**å…¬é–‹ã‚’æœ›ã‚“ã§ã„ãªã„ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚„æ›¸ãæ›ãˆãŒè¡Œã‚ã‚Œã‚‹å¯èƒ½æ€§**ãŒã‚ã‚Šã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€ç¹°ã‚Šè¿”ã—ã«ãªã‚Šã¾ã™ãŒmicroCMSã‚’æ‰±ã†éš›ã¯ã“ã®**API-keyã®æ¨©é™**ã¨**ç§˜åŒ¿åŒ–**ã«ã¤ã„ã¦ååˆ†ã«æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚

### æ¨©é™è¨­å®š

ã¾ãšæœ€åˆã«è¡Œã†ã¹ãã¯API-keyã®æ¨©é™è¨­å®šã§ã™ã€‚ã¾ãšã€API-keyã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨©é™ã¯ **GET(ãƒªã‚½ãƒ¼ã‚¹ã®å–å¾—)** ã«é™å®šã—ã¾ã—ã‚‡ã†ã€‚
https://document.microcms.io/content-api/x-microcms-api-key#h9ab4ef6b46

ã“ã‚Œã«ã‚ˆã‚Š(API-keyã¯ä¾ç„¶ã¨ã—ã¦é–²è¦§å¯èƒ½ã§ã™ãŒ)æ›¸ãè¾¼ã¿ç³»ã®å‡¦ç†ã¯é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

### ç§˜åŒ¿åŒ–
å ´åˆã«ã‚ˆã£ã¦ã¯API-keyã‚’éœ²å‡ºã•ã›ãŸããªã„ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚
ãã®éš›ã¯ã‚µãƒ¼ãƒãƒ¬ã‚¹é–¢æ•°(Lamdaãªã©)ã®åˆ©ç”¨ã‚„SSRã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã‚’ã¨ã‚Šã€ã‚µãƒ¼ãƒãƒ¬ã‚¹é–¢æ•°ã«API-keyã‚’ç½®ãã“ã¨ã«ã‚ˆã‚Šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®éœ²å‡ºãŒé˜²ã’ã¾ã™ã€‚
```mermaid
sequenceDiagram
    autonumber
    participant Next.js
    participant serverlessfunction as ã‚µãƒ¼ãƒãƒ¬ã‚¹é–¢æ•°
    participant microCMS
    
    Next.js->>serverlessfunction: contentId,draftKeyã‚’å…ƒã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    serverlessfunction->>microCMS: contentId,draftKeyã«API-keyã‚’ä»˜ä¸ã—ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    Note right ofã€€serverlessfunction: Lamdaã‚„API Routes
    microCMS->>serverlessfunction: ãƒªã‚½ãƒ¼ã‚¹è¿”å´
    serverlessfunction->>Next.js: ãƒªã‚½ãƒ¼ã‚¹è¿”å´
    Next.js->>Next.js:ã€€è¿”å´ãƒªã‚½ãƒ¼ã‚¹åŸ‹ã‚è¾¼ã¿

```

ã¾ãŸã€ã‚¤ãƒ³ãƒ•ãƒ©ãŒé™ã‚‰ã‚Œã¾ã™ãŒSSRã«ãŠã„ã¦`getServerSideProps`ã‚’åˆ©ç”¨ã™ã‚‹ã®ã‚‚æ‰‹ã§ã™ã€‚ã“ã¡ã‚‰ã‚‚ã‚µãƒ¼ãƒãƒ¼å´ã§ã®å‡¦ç†ã§ã™ã®ã§API-keyã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã‚‚ã‚Œã¾ã›ã‚“ã€‚  
ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚
```tsx
// libs/client.js
import { createClient } from "microcms-js-sdk";

export const client = createClient({
  serviceDomain: "ã‚µãƒ¼ãƒ“ã‚¹å",
  apiKey: process.env.MICROCMS_API_KEY,
});
```
```tsx
import { client } from "../../libs/client";

export default function BlogId({ data }) {
  return (
    <main>
      <h1>{data.title}</h1>
      <p>{data.publishedAt}</p>
    </main>
  );
}

export const getServerSideProps = async (context) => {
  const data = await client.get({
    endpoint: "news",
    contentId: context.query.id,
    queries: { draftKey: context.query.draftKey },
  });

  return {
    props: { data },
  };
};
```
Next.jsã§ã¯`NEXT_PUBLIC_`ã®æ¥é ­è¾ã®æœ‰ç„¡ã«ã‚ˆã£ã¦ç’°å¢ƒå¤‰æ•°ã®åˆ©ç”¨å ´æ‰€ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
https://nextjs-ja-translation-docs.vercel.app/docs/basic-features/environment-variables

API-keyã‚’éœ²å‡ºã•ã›ãŸã**ãªã„**ã‚±ãƒ¼ã‚¹ã§ã™ã®ã§ã€`NEXT_PUBLIC_`ã‚’ä½¿ã‚ãšã‚µãƒ¼ãƒãƒ¼ã§åˆ©ç”¨ã™ã‚‹ã‚ˆã†è¨­å®šã—ã¾ã—ã‚‡ã†ã€‚


:::message
ä¸Šè¨˜ã®ã‚ˆã†ãªå¯¾ç­–ã‚’ã¨ã£ãŸã¨ã—ã¦ã‚‚ã€ãã‚‚ãã‚‚ã®draftKeyã‚’å«ã‚€URLãŒæ¼æ´©ã™ã‚‹ã¨ç¬¬ä¸‰è€…ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ã•ã‚‰ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–ã™ã‚‹å ´åˆã¯ç’°å¢ƒã‚’åˆ†ã‘ã‚‹ã€Basicèªè¨¼ã‚’ä»˜ä¸ã™ã‚‹ãªã©ã®æ–½ç­–ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚
ã¾ãŸdraftKeyã¯microCMSã®ç”»é¢ã‹ã‚‰ã‹ã‚“ãŸã‚“ã«å¤‰æ›´å¯èƒ½ã§ã™ã€‚æ¼æ´©ã—ãŸå ´åˆã®å¯¾ç­–ã«ã¤ã„ã¦ã€é‹å–¶å´ã‚ã‚‰ã‹ã˜ã‚å¯¾å¿œã‚’æ±ºã‚ã¦ãŠãã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
:::

## ã¾ã¨ã‚
ä»Šå›ã¯Next.jsã¨microCMSã‚’ç”¨ã„ãŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿè£…æ–¹æ³•ã¨ãã®ç•™æ„ç‚¹ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚  
ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã‚‚ã•ã¾ã–ã¾ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã¾ãšã¯ã“ã¡ã‚‰ã§ç´¹ä»‹ã—ãŸæ–¹æ³•ã§å®Ÿè£…ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚  
ä¸€åº¦ç†è§£ã™ã‚‹ã¨ã€ä»–ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã§ã®å®Ÿè£…ã‚‚å¹¾åˆ†ã‹ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

ã¾ãŸã€ä»Šå›èµ·ç”¨ã—ãŸuseEffectã‚’ç”¨ã„ãŸfetchã¯[useSWR](https://swr.vercel.app/ja)ã‚„[Tansatck Query(React Query)](https://tanstack.com/query/v4/docs/adapters/react-query)ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã§ãã¾ã™ã€‚ã“ã¡ã‚‰ã‚‚ãœã²è©¦ã—ã¦ã¿ã¦ä¸‹ã•ã„ã€‚